{
  "kind": "build_request",
  "title": "Fix winner payout cap: raise max from 70% to 90%",
  "projectName": "LuckyCoins",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-64",
      "text": "Update the `createLottery` backend endpoint in `backend/main.mo` to change the maximum allowed `winnerPayoutPercent` from 70 to 90. The validation must reject values greater than 90 (returning `#err(#invalidPrizeConfig)`) but allow any value from 1 to 90 inclusive. This ensures the system retains at least 10% profit instead of the previously enforced 30%.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Winner payout cannot exceed 70% (system must retain at least 30%)",
          "Winner payout max 90%",
          "Failed to create lottery. Please check your inputs and try again."
        ]
      },
      "acceptanceCriteria": [
        "Creating a lottery with winnerPayoutPercent = 90 succeeds without error.",
        "Creating a lottery with winnerPayoutPercent = 91 returns #err(#invalidPrizeConfig).",
        "Creating a lottery with winnerPayoutPercent = 70 still succeeds.",
        "The 'Failed to create lottery' error no longer appears when admin sets winner payout between 71â€“90%."
      ]
    },
    {
      "id": "REQ-65",
      "text": "Update the Admin Lottery Management page (`frontend/src/pages/admin/LotteryManagement.tsx`) to change the inline validation for the 'Winner Payout %' field: allow values from 1 to 90 (not 1 to 70). Update the helper text label from 'System retains (100 - this value)% as profit. Max 70%' to 'System retains (100 - this value)% as profit. Max 90%'. Show an inline validation error only if `winnerPayoutPercent > 90` (not > 70). Update the calculated summary label 'System Profit' to reflect the correct retained percentage based on the entered value.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Winner payout cannot exceed 70% (system must retain at least 30%)",
          "Winner payout max 90%",
          "Failed to create lottery. Please check your inputs and try again."
        ]
      },
      "acceptanceCriteria": [
        "The 'Winner Payout %' input accepts values up to 90 without showing a validation error.",
        "Entering 91 or higher shows an inline validation error.",
        "The helper text reads 'System retains (100 - this value)% as profit. Max 90%'.",
        "The calculated summary correctly shows the system profit as (100 - winnerPayoutPercent)% for any valid value.",
        "Submitting the form with winnerPayoutPercent = 85 no longer results in a 'Failed to create lottery' error."
      ]
    }
  ],
  "constraints": [
    "Do not change any other prize distribution validation logic (firstPrizePercent + secondPrizePercent + thirdPrizePercent < 100 check remains unchanged).",
    "Do not modify immutable frontend paths."
  ],
  "nonGoals": [
    "Changing the prize distribution calculation logic in declareDraw.",
    "Updating the Draw Declaration results summary UI.",
    "Any changes unrelated to the winner payout percentage cap."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}